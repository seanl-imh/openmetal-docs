"use strict";(self.webpackChunkopenmetal_docs=self.webpackChunkopenmetal_docs||[]).push([[9827],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return m}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=a.createContext({}),s=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=s(e.components);return a.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,c=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=s(n),m=r,h=d["".concat(c,".").concat(m)]||d[m]||p[m]||i;return n?a.createElement(h,o(o({ref:t},u),{},{components:n})):a.createElement(h,o({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=d;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var s=2;s<i;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},4954:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return c},metadata:function(){return s},toc:function(){return u},default:function(){return d}});var a=n(7462),r=n(3366),i=(n(7294),n(3905)),o=["components"],l={slug:"/tutorials/backing-up-vm-data-with-rclone",description:"Practical example of VM data backup to Swift S3API with rclone."},c="Backup VM Data to Ceph with Swift S3API",s={unversionedId:"tutorials/backing-up-with-rclone",id:"tutorials/backing-up-with-rclone",title:"Backup VM Data to Ceph with Swift S3API",description:"Practical example of VM data backup to Swift S3API with rclone.",source:"@site/docs/tutorials/backing-up-with-rclone.md",sourceDirName:"tutorials",slug:"/tutorials/backing-up-vm-data-with-rclone",permalink:"/docs/manuals/tutorials/backing-up-vm-data-with-rclone",editUrl:"https://github.com/openmetalio/openmetal-docs/blob/main/docs/tutorials/backing-up-with-rclone.md",tags:[],version:"current",frontMatter:{slug:"/tutorials/backing-up-vm-data-with-rclone",description:"Practical example of VM data backup to Swift S3API with rclone."},sidebar:"tutorialSidebar",previous:{title:"Create a Site-to-Site VPN Connection with Endpoint Groups",permalink:"/docs/manuals/tutorials/create-site-to-site-vpn"},next:{title:"Backing Up Important Data",permalink:"/docs/manuals/tutorials/backing-up-important-data"}},u=[{value:"Overview",id:"overview",children:[],level:2},{value:"Prerequisites",id:"prerequisites",children:[{value:"Environment",id:"environment",children:[],level:3}],level:2},{value:"Rclone",id:"rclone",children:[{value:"Reasoning",id:"reasoning",children:[],level:3}],level:2},{value:"Preparation",id:"preparation",children:[],level:2},{value:"Initial S3cmd sync",id:"initial-s3cmd-sync",children:[],level:2},{value:"Incremental backups",id:"incremental-backups",children:[],level:2},{value:"Conclusion",id:"conclusion",children:[],level:2},{value:"Reference",id:"reference",children:[],level:2}],p={toc:u};function d(e){var t=e.components,n=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"backup-vm-data-to-ceph-with-swift-s3api"},"Backup VM Data to Ceph with Swift S3API"),(0,i.kt)("h2",{id:"overview"},"Overview"),(0,i.kt)("p",null,"In this guide we will demonstrate generating backups of important data from a\nproduction VM to Ceph backed object storage on your OpenMetal cloud using rclone."),(0,i.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/manuals/openstack-admin/access-swift-s3-api"},"EC2 Credentials")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/manuals/openstack-admin/swift-s3-api-access-with-rclone"},"Rclone CLI tool")),(0,i.kt)("li",{parentName:"ul"},"Familiarity with ",(0,i.kt)("a",{parentName:"li",href:"/docs/manuals/tutorials/backing-up-important-data"},"Backing Up Important Data"))),(0,i.kt)("h3",{id:"environment"},"Environment"),(0,i.kt)("p",null,"For this demonstration we have an Ubuntu focal instance serving WordPress on an\noptimized LEMP stack managed by Ansible. In this example, all service and server\nconfiguration is handled by Ansible, so only user and CMS specific content need\nbe backed up."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"The demo environment was deployed using the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/inmotionhosting/wordpress-ultrastack-ansible"},"WordPress UltraStack"),"\nAnsible playbook.")),(0,i.kt)("h2",{id:"rclone"},"Rclone"),(0,i.kt)("h3",{id:"reasoning"},"Reasoning"),(0,i.kt)("p",null,"Rclone is chosen as the preferred tool in this example due to its ",(0,i.kt)("inlineCode",{parentName:"p"},"sync")," option\nproviding similar functionality and ownership/permission preservation to the\nLinux native rsync tool. Additionally, in our testing, rclone consistently\noutperformed other tooling in speed of operations and transfers by a significant\nmargin."),(0,i.kt)("h2",{id:"preparation"},"Preparation"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Create a bucket using the server hostname or otherwise unique ID:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"rclone mkdir backup-demo:$(hostname)\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Export a full backup of the CMS database:"),(0,i.kt)("blockquote",{parentName:"li"},(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("strong",{parentName:"p"},"Note"),": We perform this manually for illustrative purposes, ideally this\nprocess is performed on a scheduled cron using native tooling.")),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"mkdir ~/sql-dump\ncd ~/sql-dump\n\n# Dump DB via WP-CLI\n$ wp db export --path=\"../doc_root\"\nSuccess: Exported to 'ubuntu-2022-12-13-7fbde57.sql'.\n")))),(0,i.kt)("h2",{id:"initial-s3cmd-sync"},"Initial S3cmd sync"),(0,i.kt)("p",null,"Now perform an initial sync of the user directory which includes the SQL dump\nfiles and document root, excluding the WordPress cache folder, with the command\nbelow:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'rclone sync /home/ubuntu/ backup-demo:$(hostname)/${USER}/ \\\n --exclude="/home/ubuntu/doc_root/wp-content/cache"\n')),(0,i.kt)("h2",{id:"incremental-backups"},"Incremental backups"),(0,i.kt)("p",null,"At times, it is unnecessary or unwarranted to create duplicate copies of\neverything whenever backups run. To reduce disk and bandwidth usage when using\nsync you can pass the ",(0,i.kt)("inlineCode",{parentName:"p"},"--backup-dir")," flag which will copy or move any files\nwhich would have been overwritten or deleted, in their original hierarchy, into\nthe directory specified. The example below updates the existing remote backup\nwith any local changes storing any incremental changes in a timestamped\nsubdirectory:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'rclone sync /home/ubuntu/ backup-demo:$(hostname)/${USER}/ \\\n --exclude="/home/ubuntu/doc_root/wp-content/cache" \\\n --backup-dir backup-demo:$(hostname)/$(date -u +%Y-%m-%dT%H:%MZ)/ \\\n --update\n')),(0,i.kt)("h2",{id:"conclusion"},"Conclusion"),(0,i.kt)("p",null,"While we have only touched on a very basic backup scenario, the tooling and\nconcepts presented should provide a foundation for you to explore, plan and\nimplement a backup strategy to fit your needs."),(0,i.kt)("h2",{id:"reference"},"Reference"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://rclone.org/commands/"},"Rclone commands"))))}d.isMDXComponent=!0}}]);