"use strict";(self.webpackChunkopenmetal_docs=self.webpackChunkopenmetal_docs||[]).push([[1508],{3905:function(e,n,t){t.d(n,{Zo:function(){return u},kt:function(){return k}});var a=t(7294);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){l(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,a,l=function(e,n){if(null==e)return{};var t,a,l={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var s=a.createContext({}),p=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},u=function(e){var n=p(e.components);return a.createElement(s.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,l=e.mdxType,o=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),d=p(t),k=l,m=d["".concat(s,".").concat(k)]||d[k]||c[k]||o;return t?a.createElement(m,r(r({ref:n},u),{},{components:t})):a.createElement(m,r({ref:n},u))}));function k(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var o=t.length,r=new Array(o);r[0]=d;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i.mdxType="string"==typeof e?e:l,r[1]=i;for(var p=2;p<o;p++)r[p]=t[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},4266:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return i},contentTitle:function(){return s},metadata:function(){return p},toc:function(){return u},default:function(){return d}});var a=t(7462),l=t(3366),o=(t(7294),t(3905)),r=["components"],i={},s="How to Prepare and Use Kolla Ansible",p={unversionedId:"operators-manual/day-4/kolla-ansible/kolla-ansible",id:"operators-manual/day-4/kolla-ansible/kolla-ansible",title:"How to Prepare and Use Kolla Ansible",description:"Introduction",source:"@site/docs/operators-manual/day-4/kolla-ansible/kolla-ansible.md",sourceDirName:"operators-manual/day-4/kolla-ansible",slug:"/operators-manual/day-4/kolla-ansible/",permalink:"/openmetal-docs/docs/operators-manual/day-4/kolla-ansible/",editUrl:"https://github.com/openmetalio/openmetal-docs/blob/main/docs/operators-manual/day-4/kolla-ansible/kolla-ansible.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"How to Prepare and Use Ceph Ansible",permalink:"/openmetal-docs/docs/operators-manual/day-4/ceph-ansible/"},next:{title:"How to Enable Elasticsearch and Kibana using Kolla Ansible",permalink:"/openmetal-docs/docs/operators-manual/day-4/kolla-ansible/enable-elk"}},u=[{value:"Introduction",id:"introduction",children:[],level:2},{value:"Before Proceeding",id:"before-proceeding",children:[],level:2},{value:"Table of Contents",id:"table-of-contents",children:[],level:2},{value:"Prerequisites",id:"prerequisites",children:[],level:2},{value:"Using Kolla Ansible Quick Start",id:"using-kolla-ansible-quick-start",children:[],level:2},{value:"Prepare Kolla Ansible for Use",id:"prepare-kolla-ansible-for-use",children:[],level:2},{value:"References",id:"references",children:[],level:2},{value:"Next Steps",id:"next-steps",children:[],level:2}],c={toc:u};function d(e){var n=e.components,t=(0,l.Z)(e,r);return(0,o.kt)("wrapper",(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"how-to-prepare-and-use-kolla-ansible"},"How to Prepare and Use Kolla Ansible"),(0,o.kt)("h2",{id:"introduction"},"Introduction"),(0,o.kt)("p",null,"Our Private Cloud Core deployments provide workload orchestration\nthrough the use of ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/openstack/kolla-ansible"},"Kolla\nAnsible")," which deploys\nOpenStack services and infrastructure components in Docker containers.\nShould you want to make a change to an OpenStack service's\nconfiguration, add a new OpenStack service, or even repair your\nOpenStack cluster, you can do so using Kolla Ansible. In this guide, we\nexplain how to prepare a Kolla Ansible environment, from which\nconfiguration changes can be made."),(0,o.kt)("h2",{id:"before-proceeding"},"Before Proceeding"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"WARNING","!")," -- Our current deployment system deploys a Private Cloud\nwith a known working state. Should you deviate from this state by\nadjusting your cloud's OpenStack configuration you can no longer safely\nuse the functions in OpenMetal Central to add nodes to your cloud or add\nIP blocks. Should you use these functions, any custom configurations\nwill be reverted. We are working on rolling out a new deployment system\nallowing custom cloud configurations. We can still help you modify your\ncloud, but must do so manually. Please reach out to your Account Manager\nshould this apply to you."),(0,o.kt)("h2",{id:"table-of-contents"},"Table of Contents"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("a",{parentName:"p",href:"./#prerequisites"},"Prerequisites"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("a",{parentName:"p",href:"#using-kolla-ansible-quick-start"},"Using Kolla Ansible Quick\nStart"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("a",{parentName:"p",href:"#prepare-kolla-ansible-for-use"},"Prepare Kolla Ansible for\nUse")),(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"#kolla-ansible-configuration-files"},"Kolla Ansible Configuration\nFiles")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"#before-making-changes"},"Before Making\nChanges")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"#prepare-kolla-ansible-environment"},"Prepare Kolla Ansible\nEnvironment")))))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("a",{parentName:"p",href:"#references"},"References"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("a",{parentName:"p",href:"#next-steps"},"Next\nSteps")))),(0,o.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Root access to your cloud's control plane nodes is required."),(0,o.kt)("li",{parentName:"ul"},"Experience using ",(0,o.kt)("a",{parentName:"li",href:"https://www.ansible.com/"},"Ansible"),".")),(0,o.kt)("h2",{id:"using-kolla-ansible-quick-start"},"Using Kolla Ansible Quick Start"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Caution","!")," Ensure the node from which you are working contains the\ndirectory ",(0,o.kt)("inlineCode",{parentName:"p"},"/etc/kolla/config"),". This directory exists on a single node\nand is used to provide our custom configuration to OpenStack services."),(0,o.kt)("p",null,"Follow this section for a summary of the commands required to prepare\nKolla Ansible. For more detailed instruction, see the section labeled\n",(0,o.kt)("a",{parentName:"p",href:"#prepare-kolla-ansible-for-use"},"Prepare Kolla Ansible for Use")," within\nthis guide.:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"# Create a folder for your Kolla Ansible environment\n$ mkdir /opt/kolla-ansible\n\n# Navigate to folder\n$ cd /opt/kolla-ansible\n\n# Initialize a Python virtual environment\n$ virtualenv .venv\n\n# Activate the virtual environment\n$ source .venv/bin/activate\n\n# Update pip\npip install --upgrade pip\n\n# Install Kolla Ansible and Ansible\n$ pip install git+https://github.com/inmotionhosting/kolla-ansible@stable/victoria\n$ pip install 'ansible>=2.9,<2.10,!=2.9.10'\n")),(0,o.kt)("p",null,"Kolla Ansible, being built off of Ansible, is executed against an\ninventory file. Each node in your cloud has a copy of the Kolla Ansible\ninventory used during cloud deployment, located as\n",(0,o.kt)("inlineCode",{parentName:"p"},"/etc/fm-deploy/kolla-ansible-inventory"),"."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Caution","!")," Read over the inventory file to ensure the hosts specified\nwithin match the hosts you intend to make changes to."),(0,o.kt)("p",null,"For a full list of available commands, see ",(0,o.kt)("a",{parentName:"p",href:"https://docs.openstack.org/kolla-ansible/latest/user/operating-kolla.html#kolla-ansible-cli"},"Kolla Ansible\nCLI"),"."),(0,o.kt)("h2",{id:"prepare-kolla-ansible-for-use"},"Prepare Kolla Ansible for Use"),(0,o.kt)("p",null,"In this section, we explain the steps needed to create an environment\nfrom which Kolla Ansible can be executed. The steps in this section\nshould be performed from the node in your cloud that contains the path\n",(0,o.kt)("inlineCode",{parentName:"p"},"/etc/kolla/config"),". This directory exists on a single node and is used\nto provide our custom configuration to OpenStack services."),(0,o.kt)("p",null,"Kolla Ansible Configuration Files\n","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~"),(0,o.kt)("p",null,"First, we introduce you to the files required for adjusting Kolla\nAnsible's configuration. These files are used when preparing Kolla\nAnsible."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Kolla Ansible Inventory: ",(0,o.kt)("inlineCode",{parentName:"li"},"/etc/fm-deploy/kolla-ansible-inventory")),(0,o.kt)("li",{parentName:"ul"},"Kolla Ansible Main Configuration: ",(0,o.kt)("inlineCode",{parentName:"li"},"/etc/kolla/globals.yml"))),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Note","!")," It is possible ",(0,o.kt)("inlineCode",{parentName:"p"},"/etc/fm-deploy/kolla-ansible-inventory"),"\nexists on a single node instead of being synced across all nodes. We\nrecently corrected a bug where the contents in ",(0,o.kt)("inlineCode",{parentName:"p"},"/etc/fm-deploy")," were not\nbeing synced across all nodes at the end of a deployment."),(0,o.kt)("p",null,"Before Making Changes ","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~"),(0,o.kt)("p",null,"Before any changes are made to the Kolla Ansible configuration, the\nfollowing variables in ",(0,o.kt)("inlineCode",{parentName:"p"},"/etc/kolla/globals.yml")," should not be modified,\notherwise they will be overwritten:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"api_interface\ncluster_interface\ndns_interface\ndocker_registry_insecure\nkolla_enable_tls_external\nkolla_external_fqdn\nkolla_external_vip_address\nkolla_internal_vip_address\nmigration_interface\nnetwork_interface\nneutron_external_interface\nopenstack_region_name\nstorage_interface\ntunnel_interface\n")),(0,o.kt)("p",null,"For more information, see the section titled ",(0,o.kt)("a",{parentName:"p",href:"#before-proceeding"},"Before\nProceeding")," at the top of this guide."),(0,o.kt)("p",null,"Prepare Kolla Ansible Environment\n","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~","~"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step 1")," - Prepare environment"),(0,o.kt)("p",null,"First ensure the node you are logged into over SSH contains the\ndirectory ",(0,o.kt)("inlineCode",{parentName:"p"},"/etc/kolla/config"),". This directory exists on a single node\nand is used to provide our custom configuration to OpenStack services."),(0,o.kt)("p",null,"Next, create a folder where you will install Kolla Ansible and its\ndependency, Ansible. For example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"mkdir /opt/kolla-ansible\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step 2")," -- Prepare Python virtual environment"),(0,o.kt)("p",null,"Navigate into the folder created previously, create a Python virtual\nenvironment and activate it:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"cd /opt/kolla-ansible\nvirtualenv .venv\nsource .venv/bin/activate\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step 3")," -- Update pip"),(0,o.kt)("p",null,"Update the virtual environment's ",(0,o.kt)("inlineCode",{parentName:"p"},"pip")," to the latest version, otherwise\npackages may not install as expected."),(0,o.kt)("p",null,"Update ",(0,o.kt)("inlineCode",{parentName:"p"},"pip")," using:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"pip install --upgrade pip\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step 4")," -- Install Kolla Ansible"),(0,o.kt)("p",null,"With the virtual environment prepared, we can now install Kolla Ansible\nand Ansible using ",(0,o.kt)("inlineCode",{parentName:"p"},"pip"),"."),(0,o.kt)("p",null,"Install Kolla Ansible, and its dependency Ansible, using these specified\nversions:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"pip install git+https://github.com/inmotionhosting/kolla-ansible@stable/victoria\npip install 'ansible>=2.9,<2.10,!=2.9.10'\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Caution","!")," -- It is important the version of Kolla Ansible installed\nduring this step match your cloud's OpenStack version. Your cloud's\nOpenStack version can be determined by looking at the Docker image tags\nassociated with the Kolla containers from the output of ",(0,o.kt)("inlineCode",{parentName:"p"},"docker image\nls"),", for example."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Step 5")," -- Kolla Ansible is Ready for Use"),(0,o.kt)("p",null,"At this step, you have everything prepared to use Kolla Ansible. Before\nproceeding, familiarize yourself with the available Kolla Ansible\ncommands by running ",(0,o.kt)("inlineCode",{parentName:"p"},"kolla-ansible --help"),". There are a number of\nfunctions possible, including maintenance tasks or making configuration\nchanges to your Private Cloud."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Caution","!")," -- Kolla Ansible's configuration is set through the file\n",(0,o.kt)("inlineCode",{parentName:"p"},"/etc/kolla/globals.yml")," where some variables should not be changed. See\nthe section titled ",(0,o.kt)("a",{parentName:"p",href:"kolla-ansible#before-making-changes"},"Before Making\nChanges"),"\nat the top of this guide for more information."),(0,o.kt)("p",null,"An example configuration change made at this step is to enable TLS for\nHorizon. Enabling TLS falls outside the scope of this guide. For\ninstruction on how to do so, see ",(0,o.kt)("a",{parentName:"p",href:"enable-tls"},"How to Enable TLS for\nOpenStack"),"."),(0,o.kt)("p",null,"For complete documentation regarding available Kolla Ansible commands,\nsee ",(0,o.kt)("a",{parentName:"p",href:"https://docs.openstack.org/kolla-ansible/latest/user/operating-kolla.html"},"Operating\nKolla"),"."),(0,o.kt)("h2",{id:"references"},"References"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.openstack.org/kolla-ansible/latest/"},"OpenStack Kolla Ansible\ndocumentation")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.openstack.org/kolla-ansible/latest/user/quickstart.html"},"Kolla Ansible Quick\nStart"))),(0,o.kt)("h2",{id:"next-steps"},"Next Steps"),(0,o.kt)("p",null,"The following guides go into detail about specific things you can\nconfigure using Kolla Ansible, such enabling TLS for Horizon or enabling\nCentral Logging with an ELK stack:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"enable-tls"},"Enable TLS for\nHorizon")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"enable-elk"},"Enable Central Logging using\nELK"))))}d.isMDXComponent=!0}}]);